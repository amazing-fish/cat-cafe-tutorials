# OpenCats 项目演进报告（重构提案）

## 1. 背景与目标
当前仓库以教程文档为主，已沉淀三猫协作理念与 CLI 工程化经验。下一阶段目标是将教程资产升级为可持续演进的工程项目 **OpenCats**：
- 复用现有认知资产（愿景、决策、作业、踩坑）作为设计输入。
- 接入 `maomaov2` 前端能力，补齐服务端编排与认证桥。
- 通过 CLI 官方订阅授权连接 GPT 与 Gemini（并保留 Claude 路径）。

## 2. 现状诊断（as-is）
1. **资产偏知识化**：教程内容完整，但工程目录与运行入口尚未成型。
2. **前端偏原型化**：`maomaov2.html` 可作为 UI 参考，但尚未形成端到端链路。
3. **多模型协作能力分散**：文档中有实践经验，缺统一 orchestrator 与状态面。
4. **版本治理缺口**：缺少统一的 SemVer 与变更分类规范落地文件。

## 3. 目标架构（to-be）

### 3.1 逻辑架构
- **Web Workbench（maomaov2）**：会话入口 + 任务可视化 + 模型状态。
- **OpenCats API**：统一会话 API、任务 API、运行指标 API。
- **Agent Orchestrator**：路由策略、并发策略、超时重试、任务仲裁。
- **CLI Connector**：Claude / GPT / Gemini 官方 CLI 适配与 auth 检测。
- **Memory & Audit**：消息、决策、执行日志与错误快照。

### 3.2 最小可运行数据流
1. 用户在前端发起任务。
2. API 生成 trace-id 与任务上下文。
3. Orchestrator 选择目标 Agent（单播或多播）。
4. Connector 调用对应 CLI，流式回传结果。
5. Memory 持久化全过程并生成可追溯记录。

## 4. 分阶段演进路线图

### 阶段 P0（1~2 周）：工程骨架与认证打通
- 建立目录结构：`apps/web`、`apps/api`、`packages/orchestrator`、`packages/connectors`。
- 落地 CLI auth 检测命令与健康检查端点。
- 对接 `maomaov2` 的最小 API（发消息/收消息/模型状态）。

**完成定义（DoD）**
- 可在本地完成 GPT、Gemini 至少一种模型的官方订阅调用。
- 端到端能跑通“发送问题→获得回复→落盘日志”。

### 阶段 P1（2~4 周）：协作编排与可靠性
- 增加多 Agent 协作模式（顺序协作、并发评审、汇总仲裁）。
- 引入超时、重试、幂等 key 与失败补偿。
- 增加任务级可观测指标（耗时、失败率、重试率）。

**完成定义（DoD）**
- 至少 3 类协作模板可配置。
- 失败任务可回放，日志可还原关键决策路径。

### 阶段 P2（4~8 周）：产品化与治理
- 权限模型（谁可触发哪些 Agent/工具）。
- 审计视图（Why-First 结构化展示）。
- 发布流程与回滚策略标准化。

**完成定义（DoD）**
- 完成首版“可内测”协作平台。
- 有清晰版本发布节奏（双周或月度）。

## 5. 关键技术决策建议
1. **先 CLI 后 SDK**：沿用教程里的经验，优先稳定官方 CLI 调用链。
2. **轻编排优先**：早期采用代码化 orchestrator，避免过早引入重量级工作流系统。
3. **日志即产品**：把执行日志设计为后续评估和调优核心资产。
4. **协议先行**：统一任务元数据（trace-id, task-id, parent-id, role, why 字段）。

## 6. 风险与缓解
- **CLI 输出格式波动**：对解析层做版本探测与宽松兼容。
- **认证态失效**：健康检查显式返回 auth 状态并引导重登。
- **多 Agent 冲突**：设置仲裁器与冲突解决策略（优先级/可信度分）。
- **上下文膨胀**：引入摘要层与分层记忆（短期/长期）。

## 7. 里程碑交付件（建议）
- M1：架构蓝图 + API 草案 + auth 验证脚本。
- M2：三模型最小协作 demo + 回放日志工具。
- M3：可内测版本（含权限与审计视图）。

## 8. 版本与变更策略（执行面）
- 固定采用 `v主.次.修`。
- 每次合并必须标注变更类型：`feature` / `bugfix` / `refactor`。
- 版本发布同时更新：
  1) `CHANGELOG`
  2) 本演进报告（必要时）
  3) Anchor 文档（仅关键锚点变化时）

## 9. 下一步行动（建议本周）
1. 把 `maomaov2` 事件接口映射成 OpenCats API 协议草案。
2. 先实现 GPT/Gemini connector 的 auth + hello-world 调用。
3. 创建 P0 看板与验收清单，按 DoD 推进。
